(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{332:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"编译openjdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译openjdk"}},[s._v("#")]),s._v(" 编译OpenJDK")]),s._v(" "),t("h2",{attrs:{id:"为啥要编译-jdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为啥要编译-jdk"}},[s._v("#")]),s._v(" 为啥要编译 jdk")]),s._v(" "),t("p",[s._v("通常来说编译 OpenJDK 的目的是为了调试、定制化等需求；和我们使用开源的 Java 中间件一样，如果需要做定制化的话，可以将其源代码下载下来再修改，然后打包出来使用。")]),s._v(" "),t("h2",{attrs:{id:"准备编译环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备编译环境"}},[s._v("#")]),s._v(" 准备编译环境")]),s._v(" "),t("p",[s._v("安装 "),t("code",[s._v("gcc")])]),s._v(" "),t("div",{staticClass:"language-bahs line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("apt-get install build-essential\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("安装工具软件项")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libfreetype6-dev\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libcups2-dev\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libx11-dev libxext-dev libxrender-dev libxrandr-dev libxtst-dev libxt-dev\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libasound2-dev\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libffi-dev\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" autoconf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("zip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" libfontconfig1-dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("安装 "),t("code",[s._v("jdk")]),s._v("，该 "),t("code",[s._v("jdk")]),s._v(" 是为了编译 "),t("code",[s._v("openjdk")]),s._v("，本次准备编译 "),t("code",[s._v("openjdk-12")]),s._v("，环境要求安装 "),t("code",[s._v("N-1")]),s._v(" 版本的 "),t("code",[s._v("jdk")]),s._v("，所以安装 "),t("code",[s._v("openjdk-11")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openjdk-11-jdk\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下载 "),t("code",[s._v("OpenJDK")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/openjdk/jdk/archive/refs/tags/jdk-12-ga.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解压缩")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("tar -zxvf jdk-12-ga.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("进入 jdk 目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd jdk-jdk-12-ga\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"编译配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译配置"}},[s._v("#")]),s._v(" 编译配置")]),s._v(" "),t("p",[s._v("开始编译配置，FastDebug 版、仅包含 Server 模式的 "),t("code",[s._v("HotSpot")]),s._v(" 虚拟机")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("bash configure --enable-debug --with-jvm-variants=server\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("参数介绍祥见 "),t("a",{attrs:{href:"#%E9%99%84%E5%BD%95%EF%BC%9A%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"}},[s._v("附录")])]),s._v(" "),t("blockquote",[t("p",[s._v("如果失败，控制台会告诉我们缺少的依赖项，按提示安装需要的依赖即可")])]),s._v(" "),t("p",[s._v("配置成功，会看到")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("A new configuration has been successfully created "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n/app/jdk-jdk-12-ga/build/linux-x86_64-server-fastdebug\nusing configure arguments "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'--enable-debug --with-jvm-variants=server'")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\nConfiguration summary:\n* Debug level:    fastdebug\n* HS debug level: fastdebug\n* JVM variants:   server\n* JVM features:   server: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'aot cds cmsgc compiler1 compiler2 epsilongc g1gc graal jfr jni-check jvmci jvmti management nmt parallelgc serialgc services shenandoahgc vm-structs zgc'")]),s._v(" \n* OpenJDK target: OS: linux, CPU architecture: x86, address length: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n* Version string: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("-internal+0-adhoc.root.jdk-jdk-12-ga "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("-internal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nTools summary:\n* Boot JDK:       openjdk version "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"11.0.12"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-07-20 OpenJDK Runtime Environment "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".12+7-post-Debian-2deb10u1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" OpenJDK "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("-Bit Server VM "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("build "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.0")]),s._v(".12+7-post-Debian-2deb10u1, mixed mode, sharing"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at /usr/lib/jvm/java-11-openjdk-amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n* Toolchain:      gcc "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GNU Compiler Collection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n* C Compiler:     Version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.3")]),s._v(".0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at /usr/bin/gcc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n* C++ Compiler:   Version "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.3")]),s._v(".0 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("at /usr/bin/g++"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nBuild performance summary:\n* Cores to use:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n* Memory limit:   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3867")]),s._v(" MB\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("h2",{attrs:{id:"开始编译"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始编译"}},[s._v("#")]),s._v(" 开始编译")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" images\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"编译完成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编译完成"}},[s._v("#")]),s._v(" 编译完成")]),s._v(" "),t("p",[s._v("编译完成之后，进入"),t("code",[s._v("OpenJDK")]),s._v("源码的"),t("code",[s._v("build/配置名称/jdk")]),s._v("目录下就可以看到"),t("code",[s._v("OpenJDK")]),s._v("的完整编译结果了，把它复制到"),t("code",[s._v("JAVA_HOME")]),s._v("目录，就可以作为一个完整的"),t("code",[s._v("JDK")]),s._v("来使用")]),s._v(" "),t("h2",{attrs:{id:"附录：编译配置参数说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#附录：编译配置参数说明"}},[s._v("#")]),s._v(" 附录：编译配置参数说明")]),s._v(" "),t("ul",[t("li",[s._v("--with-debug-level="),t("level",[s._v("：设置编译的级别，可选值为release、fastdebug、slowde-bug，越往后进行的优化措施就越少，带的调试信息就越多。还有一些虚拟机调试参数必须在特定模式下才可以使用。默认值为release。")])],1),s._v(" "),t("li",[s._v("--enable-debug：等效于--with-debug-level=fastdebug。")]),s._v(" "),t("li",[s._v("--with-native-debug-symbols="),t("method",[s._v("：确定调试符号信息的编译方式，可选值为none、internal、external、zipped。")])],1),s._v(" "),t("li",[s._v("--with-version-string="),t("string",[s._v("：设置编译JDK的版本号，譬如java-version的输出就会显示该信息。这个参数还有--with-version-"),t("part",[s._v("="),t("value",[s._v("的形式，其中part可以是pre、opt、build、major、minor、security、patch之一，用于设置版本号的某一个部分。")])],1)],1)],1),s._v(" "),t("li",[s._v("--with-jvm-variants="),t("variant",[s._v("[，"),t("variant",[s._v("...]：编译特定模式（Variants）的HotSpot虚拟机，可以多个模式并存，可选值为server、client、minimal、core、zero、custom。")])],1)],1),s._v(" "),t("li",[s._v("--with-jvm-features="),t("feature",[s._v("[，"),t("feature",[s._v("...]：针对--with-jvm-variants=custom时的自定义虚拟机特性列表（Features），可以多个特性并存，由于可选值较多，请参见help命令输出。")])],1)],1),s._v(" "),t("li",[s._v("--with-target-bits="),t("bits",[s._v("：指明要编译32位还是64位的Java虚拟机，在64位机器上也可以通过交叉编译生成32位的虚拟机。")])],1),s._v(" "),t("li",[s._v("--with-"),t("lib",[s._v("="),t("path",[s._v("：用于指明依赖包的具体路径，通常使用在安装了多个不同版本的Bootstrap JDK和依赖包的情况。其中lib的可选值包括boot-jd、freetype、cups、x、alsa、libffi、jtreg、libjpeg、giflib、libpng、lcms、zlib。")])])],1),s._v(" "),t("li",[s._v("--with-extra-"),t("flagtype",[s._v("="),t("flags",[s._v("：用于设定C、C++和Java代码编译时的额外编译器参数，其中flagtype可选值为cflags、cxxflags、ldflags，分别代表C、C++和Java代码的参数。\n·--with-conf-name="),t("name",[s._v("：指定编译配置名称，OpenJDK支持使用不同的配置进行编译，默认会根据编译的操作系统、指令集架构、调试级别自动生成一个配置名称，譬如“linux-x86_64-server-release”，如果在这些信息都相同的情况下保存不同的编译参数配置，就需要使用这个参数来自定义配置名称。")])],1)],1)],1)]),s._v(" "),t("p",[s._v("以上是configure命令的部分参数，其他未介绍到的可以使用"),t("code",[s._v("bash configure--help")]),s._v("来查看")]),s._v(" "),t("h2",{attrs:{id:"参考书籍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考书籍"}},[s._v("#")]),s._v(" 参考书籍")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://book.douban.com/subject/34907497/",target:"_blank",rel:"noopener noreferrer"}},[s._v("《深入理解Java虚拟机》"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);